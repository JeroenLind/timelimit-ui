<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TimeLimit UI</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 2rem auto; }
    input, button { padding: 0.4rem; margin: 0.2rem 0; }
    pre { background: #f5f5f5; padding: 0.5rem; }
    .section { border: 1px solid #ddd; padding: 1rem; margin-bottom: 1rem; }
  </style>
</head>
<body>
  <h1>TimeLimit UI</h1>

  <div class="section">
    <h2>Version</h2>
    <button id="version-btn">Get version</button>
    <pre id="version-output"></pre>
  </div>

  <div class="section">
    <h2>Time test</h2>
    <button id="time-btn">Test /time</button>
    <pre id="time-output"></pre>
  </div>

  <div class="section">
    <h2>Login</h2>
    <label>Email:<br><input type="email" id="email"></label><br>
    <label>Password:<br><input type="password" id="password"></label><br>
    <button id="login-btn">Login</button>
    <pre id="login-output"></pre>
  </div>

  <div class="section">
    <h2>Children (after login)</h2>
    <button id="children-btn">Load children</button>
    <pre id="children-output"></pre>
  </div>

  <script>
    let sessionCookie = null;

    async function call(path, options = {}) {
      const res = await fetch(path, {
        headers: { "Content-Type": "application/json" },
        ...options
      });
      const text = await res.text();
      let json;
      try { json = JSON.parse(text); } catch { json = { raw: text }; }
      return { status: res.status, body: json };
    }

    document.getElementById("version-btn").onclick = async () => {
      const out = document.getElementById("version-output");
      out.textContent = "Loading...";
      const { status, body } = await call("/api/version");
      out.textContent = `Status: ${status}\n` + JSON.stringify(body, null, 2);
    };

    document.getElementById("time-btn").onclick = async () => {
      const out = document.getElementById("time-output");
      out.textContent = "Loading...";
      const { status, body } = await call("/api/time");
      out.textContent = `Status: ${status}\n` + JSON.stringify(body, null, 2);
    };

    document.getElementById("login-btn").onclick = async () => {
      const out = document.getElementById("login-output");
      out.textContent = "Logging in...";
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      const { status, body } = await call("/api/login", {
        method: "POST",
        body: JSON.stringify({ email, password })
      });

      out.textContent = `Status: ${status}\n` + JSON.stringify(body, null, 2);

      if (body.cookie) {
        sessionCookie = body.cookie;
        out.textContent += `\n\nSession cookie stored.`;
      } else {
        out.textContent += `\n\nNo cookie returned.`;
      }
    };

    document.getElementById("children-btn").onclick = async () => {
      const out = document.getElementById("children-output");
      out.textContent = "Loading children...";
      if (!sessionCookie) {
        out.textContent = "No session cookie. Please login first.";
        return;
      }

      const { status, body } = await call("/api/children", {
        method: "POST",
        body: JSON.stringify({ cookie: sessionCookie })
      });

      out.textContent = `Status: ${status}\n` + JSON.stringify(body, null, 2);
    };
  </script>
</body>
</html>