<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: sans-serif; background: #0b0e14; color: #e1e1e1; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { height: 60px; padding: 0 20px; background: #151921; border-bottom: 1px solid #232a35; display: flex; justify-content: space-between; align-items: center; }
        .main-container { display: grid; grid-template-columns: 1fr 450px; flex: 1; min-height: 0; }
        .dashboard-view { padding: 20px; overflow-y: auto; }
        .inspector-panel { background: #050505; border-left: 1px solid #232a35; display: flex; flex-direction: column; }
        #json-view { flex: 1; padding: 15px; font-family: monospace; font-size: 11px; color: #03a9f4; white-space: pre-wrap; overflow-y: auto; }
        #log-area { background: #000; color: #00ff00; padding: 10px; height: 200px; overflow-y: auto; font-family: monospace; font-size: 11px; border-top: 1px solid #333; }
        .btn { background: #03a9f4; color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .status-dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
    </style>
</head>
<body>
<header>
    <div><strong>TimeLimit Control Panel v41</strong></div>
    <div><button class="btn" onclick="fetchFullStatus()">ðŸ”„ Sync Nu</button></div>
</header>
<div class="main-container">
    <div class="dashboard-view">
        <div id="connection-status">
            <span id="dot" class="status-dot" style="background: grey;"></span>
            <span id="status-text">Wachten op sync...</span>
        </div>
        <hr style="border: 0; border-top: 1px solid #232a35; margin: 20px 0;">
        <div id="ui-content">Gebruik de Sync knop om data op te halen.</div>
    </div>
    <div class="inspector-panel">
        <div style="padding: 10px; font-size: 10px; color: #888;">RAW SERVER RESPONSE</div>
        <div id="json-view">Geen data.</div>
        <div id="log-area"></div>
    </div>
</div>

<script>
    const TOKEN = "###TOKEN###";

    function addLog(msg, isError = false) {
        const log = document.getElementById('log-area');
        const color = isError ? "#ff4444" : "#00ff00";
        log.innerHTML += `<div style="color:${color}">[${new Date().toLocaleTimeString()}] ${msg}</div>`;
        log.scrollTop = log.scrollHeight;
    }

    async function fetchFullStatus() {
        if (!TOKEN || TOKEN.includes("###")) {
            addLog("Fout: Geen auth_token gevonden in config!", true);
            return;
        }

        document.getElementById('dot').style.background = "orange";
        document.getElementById('status-text').innerText = "Bezig met syncen...";
        addLog("Sync proces gestart...");

        try {
            const res = await fetch('/sync', {
                method: 'POST',
                body: JSON.stringify({
                    deviceAuthToken: TOKEN,
                    status: { users: "{}", devices: "{}", clientLevel: 3 }
                })
            });

            const data = await res.json();
            document.getElementById('json-view').textContent = JSON.stringify(data, null, 2);

            if (res.ok) {
                document.getElementById('dot').style.background = "#00ff00";
                document.getElementById('status-text').innerText = "Verbonden & Actueel";
                addLog("Sync succesvol!");
            } else {
                throw new Error(`Server gaf status ${res.status}`);
            }
        } catch (e) {
            document.getElementById('dot').style.background = "#ff4444";
            document.getElementById('status-text').innerText = "Sync fout";
            addLog("Fout: " + e.message, true);
        }
    }

    // Automatische sync bij start
    fetchFullStatus();
</script>
</body>
</html>